---
title: 'Blog Post #1'
author: "Ellie Grueskin"
date: "2022-09-10"
output:
  pdf_document: default
  html_document: default
slug: []
categories: []
tags: []
---

In this blog post, I focus on the third extension project: Swing state map
Extension Swing State
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
h<-read.csv("Week1_data/house party vote share by district 1948-2020.csv")
library(tidyverse)
library(usmap)
```

```{r, message=FALSE}

#Find house averages by state and year
h_avg <- h %>%
  select(raceYear, State,  RepVotes, DemVotes) %>%
# summarize party vote share by state
  group_by(State,raceYear) %>%
# mutate Rep vote margin by state %>%
  summarise(R_votemargin_st = (sum(RepVotes))/
           sum(RepVotes + DemVotes),
D_votemargin_st = (sum(DemVotes))/
sum(RepVotes + DemVotes)) %>%
rename(state = State)

# code na if uncontested
h_avg_2<-h_avg %>%
  group_by(state) %>%
  mutate(uncontested=ifelse(R_votemargin_st==1|D_votemargin_st==1,1,0))%>%
  mutate(R_votemargin_st=na_if(R_votemargin_st, 0),
         R_votemargin_st=na_if(R_votemargin_st, 1)) %>%
  mutate(diff = R_votemargin_st-lag(R_votemargin_st,2))


p<-plot_usmap(data=h_avg_2%>% filter(raceYear>1950), regions = "states", values = "diff") +
  facet_wrap(~raceYear) +
  scale_fill_gradient2(low = "blue", mid="white",high = "red", name = "Diff")+
  theme_void()
p$layers[[2]]$aes_params$size <- 2
print(p)


                       #in GOP  4-yr \n voteshare margin\n gray means uncontested or not available") +

```

Visualization
```{r, message=FALSE}
plot_usmap(data = h_avg%>% filter(raceYear==1988), regions = "states", values = "R_votemargin_st") +
  scale_fill_gradient2(low = "blue", mid="white",high = "red", name = "R Vote Margin, 1988") +
  theme_void()


urlfile="https://raw.githubusercontent.com/kjhealy/fips-codes/master/county_fips_master.csv"

R_2 <- h %>%
    filter(raceYear == 2014) %>%
    select(raceYear, State, district_num, RepVotesMajorPercent, DemVotesMajorPercent) %>%
  # summarize party vote share by district
    group_by(State,district_num) %>%
    summarise(Rep_votes_pct = RepVotesMajorPercent) %>%
# rename district variable name to match shapefile
    rename(DISTRICT = district_num,STATENAME=State)
# require(tidyverse)
# require(ggplot2)
# require(sf)
# # load geographic data
# get_congress_map <- function(cong=114) {
#   tmp_file <- tempfile()
#   tmp_dir <- tempdir()
#   zp <- sprintf("https://cdmaps.polisci.ucla.edu/shp/districts114.zip",cong) 
#   download.file(zp, tmp_file)
#     unzip(zipfile = tmp_file, exdir = tmp_dir)
#     fpath <- paste(tmp_dir, sprintf("districtShapes/districts114.shp",cong), sep = "/")
#     st_read(fpath)
# }
# 
# cd114 <- get_congress_map(114)
# cd114 <- cd114%>%
#             mutate(DISTRICT = as.character(DISTRICT))%>%
#             select(DISTRICT,STATENAME)
# cd114$DISTRICT <- as.numeric(cd114$DISTRICT)
# # join election returns with shapefiles
# cd114 <- cd114 %>% left_join(R_2, by=c("DISTRICT","STATENAME"))
# cd114
#  #%in%c('Arizona','Georgia','Iowa','Pennsylvania'))
# 
# ggplot(data=cd114%>% filter(STATENAME %in% c('New York'))) +
#          geom_sf(aes(fill=Rep_votes_pct),
#           inherit.aes=FALSE,alpha=0.9) +
#   scale_fill_gradient(low = "white", high = "red", limits=c(10,80)) +
#   theme(axis.title.x=element_blank(),
#         axis.text.x=element_blank(),
#         axis.ticks.x=element_blank(),
#         axis.title.y=element_blank(),
#         axis.text.y=element_blank(),
#         axis.ticks.y=element_blank()) 
# 
# +geom_label(
#     label=rownames(cd114), 
#     nudge_x = 0.25, nudge_y = 0.25, 
#     check_overlap = T
#   )
```

